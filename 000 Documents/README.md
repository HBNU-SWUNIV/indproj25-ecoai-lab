# Documents
# 자율주행 주차 로봇 시스템

**개요**
본 문서는 도심 주차 문제 해결을 위한 '자율주행 주차 로봇 시스템'의 기술 아키텍처, 핵심 알고리즘 및 성능 검증 결과를 기술함.

-----

## Ⅰ. 추진 배경 및 목적

### 1\. 현황 및 문제점

  * **도심 주차난 심화:** 인구 밀집 및 차량 증가로 인한 주차 공간 부족 현상이 심화됨에 따라 사회적 비용 증가 및 시민 불편 야기.
  * **기존 시스템의 한계:**
      * **(환경 강인성 부족)** 조도 변화(야간, 역광) 및 기상 악화(우천) 시 기존 광학 센서 기반 시스템의 인식률 급감.
      * **(Sim-to-Real Gap)** 시뮬레이션 환경과 실제 물리 환경 간의 오차로 인한 알고리즘 성능 저하 발생.

### 2\. 추진 목적

  * **대안 제시:** 자율주행 주차 로봇을 통한 공간 효율성 극대화 및 사용자 편의성 제고.
  * **기술 신뢰성 확보:** 데이터 중심(Data-Centric) 인식 모듈 및 리스크 기반 제어 로직을 통한 비정형 환경 대응 능력 강화.

### 3\. 기대 효과

  * **(공간 효율성)** 승하차 공간 불필요로 기존 자주식 주차장 대비 약 **30% 이상의 추가 주차면 확보**.
  * **(안전성 향상)** '문콕' 사고 및 보행자 접촉 사고 위험의 원천적 차단.

<br>

## Ⅱ. 시스템 아키텍처 및 설계


| <img src="https://github.com/user-attachments/assets/0199bfd5-bc20-44b9-b3fc-65a73eb404fa" width="100%"> |
| :---: | 
| 아키텍처 |

### 1\. 설계 원칙

  * **모듈화(Modularity):** 독립적 개발 및 테스트가 가능한 구조 확립.
  * **실시간성(Real-time):** 주차선 및 장애물 탐지의 실시간 처리 보장.
  * **강인성(Robustness):** 외부 환경 변화에 강인한 인식 성능 확보.

### 2\. 핵심 요구사항

| 구분 | 주요 내용 |
| :--- | :--- |
| **실시간 객체 탐지** | YOLO 기반 주차선, 장애물(차량/보행자), 공간 실시간 식별 |
| **다중 환경 강인성** | 야간, 우천 등 비정형 환경에서의 인식 성능 유지 |
| **인터페이스** | 한국어 음성 명령 인식 및 로봇 제어 시나리오 수행 |
| **정밀 모션 제어** | 평행/수직 주차를 위한 정밀 경로 계획 알고리즘 구현 |
| **사전 검증** | ROS 및 Gazebo 시뮬레이터를 활용한 통합 검증 체계 구축 |

### 3\. 소프트웨어 데이터 파이프라인

  * **프레임 획득:** ROS 토픽 또는 로컬 카메라로부터 영상 데이터 수신 (`_get_frame`)
  * **인지(Perception):**
      * 객체 탐지 (`YoloDetector`): 장애물 위치 및 클래스 식별.
      * 주차선 검출 (`LineDetector`): IPM 변환 및 허프 변환 수행.
  * **판단(Decision):** 주차 공간 유효성 평가 및 리스크 스코어 산출 (`ParkingEvaluator`).
  * **제어(Control):** 판정 결과에 따른 속도 명령 생성 및 발행 (`RosGazeboBridge`).

<br>

## Ⅲ. 핵심 기술 분석

### 1\. 다중 환경 강인성 확보를 위한 인식 모듈

#### 가. YOLOv8-lite 기반 객체 탐지

  * **(모델 선정)** 임베디드 환경에서의 실시간성 확보를 위해 경량화 모델 `YOLOv8-lite` 채택.
  * **(최적화 전략)**
      * TensorBoard 활용 학습 과정 분석 및 Anchor Box 재산출(K-means Clustering).
      * **데이터 중심 접근(Data-Centric):** 야간, 역광 등 취약 환경 데이터 직접 수집 및 증강(Augmentation) 기법 적용.
  * **(주요 설정)**
      * `conf_thres`: 0.4 / `iou_thres`: 0.5
      * 감지 클래스: 차량(Vehicle), 보행자(Person)

#### 나. IPM 및 허프 변환 기반 주차선 인식

  * **(파이프라인)** `IPM 변환` $\rightarrow$ `이미지 전처리` $\rightarrow$ `허프 변환`
  * **(IPM (Inverse Perspective Mapping))** 원근 왜곡을 제거하여 Top-view 이미지 생성, 평행성 확보를 통한 검출 정밀도 향상.
  * **(전처리 고도화)**
      * Grayscale 변환 및 Gaussian Blur로 노이즈 억제.
      * **적응형 이진화(Adaptive Threshold):** 조명 불균일 상황 대응을 위해 영역별 동적 임계값 적용.

### 2\. 리스크 기반 판단 및 제어 모듈

#### 가. 주차 가능 공간 평가 로직 (`ParkingEvaluator`)

  * **1단계 (후보군 추출):** 검출된 라인 중 평행한 쌍(Pair)을 주차 공간 후보로 선정.
  * **2단계 (물리적 제약 검사):** 주차 폭(2.1m\~3.0m) 및 평행 오차(8도 이내) 충족 여부 필터링.
  * **3단계 (리스크 산출):** 장애물과의 거리를 기반으로 리스크 스코어(0.0\~1.0) 산출.
      * 100px 이내: Risk $\approx$ 1.0 (위험)
      * 400px 이상: Risk $\approx$ 0.0 (안전)

#### 나. 3단계 판정 및 제어 명령 생성

시스템은 산출된 리스크 스코어에 따라 주차 가능 여부를 3단계로 판정하고 대응하는 제어 명령을 ROS 토픽(`/cmd_vel`)으로 발행함.

| 판정 결과 | 조건 (Risk Score) | 제어 전략 (ROS Command) |
| :---: | :--- | :--- |
| **가능 (POSSIBLE)** | Risk \< 0.4 | **전진 진입** (공간 확보 완료) |
| **보류 (HOLD)** | 0.4 $\le$ Risk \< 0.7 | **제자리 회전** (재탐색 및 대기) |
| **불가 (IMPOSSIBLE)** | Risk $\ge$ 0.7 | **정지** (진입 불가 상태) |

<br>

## Ⅳ. 시스템 통합 및 검증

### 1\. 시뮬레이션 환경 구축

  * **플랫폼:** Ubuntu 기반 ROS1 (Robot Operating System) 활용.
  * **시뮬레이터:** Gazebo 상에 TurtleBot3 모델 및 가상 센서(Camera, LiDAR) 구현.
  * **통신 체계:** `/camera/color/image_raw` (입력) $\leftrightarrow$ `/cmd_vel` (출력)

### 2\. 성능 검증 결과

  * **정량적 지표:** Precision(정밀도), Recall(재현율), mAP 지표를 활용하여 모델 최적화 수행.
  * **주요 식별 과제:**
      * **Sim-to-Real Gap:** 가상 센서와 실제 물리 환경 간의 특성 차이로 인한 성능 격차 확인.
      * **통신 지연:** ROS 비동기 통신 구조로 인한 데이터 동기화 문제 식별.

<br>

## Ⅴ. 결론 및 향후 계획

### 1\. 결론

  * YOLOv8-lite 및 IPM 기술을 융합하여 실시간 주차선/장애물 인식 모델을 성공적으로 구현함.
  * 특히, 비정형 환경 데이터를 활용한 학습 전략이 시스템의 강인성 확보에 결정적임을 확인함.
  * 평행/수직 주차 경로 알고리즘을 ROS 환경에 통합하여 가상 시나리오 검증을 완료함.

### 2\. 향후 계획

  * **실테스트:** 알고리즘을 실제 하드웨어에 이식하여 Sim-to-Real Gap 최소화 연구 수행.
  * **통신 최적화:** DDS 도입 등을 통한 실시간 데이터 전송 지연 문제 해결 및 시스템 반응성 향상.
